<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Indoor Positioning Heatmap For Supermarket</title>
  <link href="{{ url_for('static', filename='output.css') }}" rel="stylesheet">
</head>
<body class="bg-white flex flex-row min-h-screen p-6 gap-6">

  <!-- Left Panel -->
  <div class="flex flex-col w-1/5 space-y-6">
    <h1 class="text-4xl font-extrabold text-black leading-tight">
      Indoor<br>Positioning<br>Heatmap For<br>Supermarket
    </h1>

    <div class="mt-4">
      <label for="modeSelector" class="text-lg font-semibold text-black">Select Source:</label>
      <select id="modeSelector" class="mt-2 block border border-gray-300 rounded p-2">
        <option value="ble" selected>BLE</option>
        <option value="wifi">WiFi</option>
        <option value="hybrid">Hybrid (BLE + WiFi)</option>
      </select>
    </div>
  </div>

  <!-- Right Panel: Heatmap Container -->
  <div class="flex-grow max-w-[1200px]">
    <div id="heatmapContainer" class="w-full h-auto"></div>
  </div>

  <!-- Load heatmap from Flask into iframe -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const container = document.getElementById("heatmapContainer");
      const selector = document.getElementById("modeSelector");

      function escapeHTML(str) {
        return str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
      }

      function loadHeatmap(mode = "ble") {
        fetch(`/plotly-heatmap?mode=${mode}`)
          .then(res => res.text())
          .then(html => {
            container.innerHTML = `<iframe style="width:100%; height:100vh; border:none;" srcdoc='${escapeHTML(html)}'></iframe>`;
          });
      }

      selector.addEventListener("change", () => {
        loadHeatmap(selector.value);
      });

      // Initial load
      loadHeatmap("ble");
    });
  </script>
</body>
</html>
